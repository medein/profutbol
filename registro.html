<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Usuario - ProFutbol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .card {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 450px;
        }
        .btn-blue {
            background-color: #3b82f6; 
            color: white;
        }
        .btn-blue:hover {
            background-color: #2563eb;
        }
    </style>
</head>
<body>
    <div class="card">
        <h2 class="text-2xl font-bold text-green-700 mb-4">Registro de Usuario</h2>
        <p class="mb-6 text-gray-600">Crea una cuenta para.</p>

        <form id="registroAdminForm">
            <div id="message" class="mb-4 p-3 rounded text-sm hidden"></div>

            <div class="mb-4">
                <label for="adminEmail" class="block text-sm font-medium text-gray-700">Correo Electrónico</label>
                <input type="email" id="adminEmail" required class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="admin@ejemplo.com">
            </div>

            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="adminNombre" class="block text-sm font-medium text-gray-700">Nombre</label>
                    <input type="text" id="adminNombre" required class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label for="adminApellido" class="block text-sm font-medium text-gray-700">Apellido</label>
                    <input type="text" id="adminApellido" required class="mt-1 block w-full border border-gray-300 rounded-md p-2">
                </div>
            </div>

            <div class="mb-6">
                <label for="adminPassword" class="block text-sm font-medium text-gray-700">Contraseña</label>
                <input type="password" id="adminPassword" required minlength="6" class="mt-1 block w-full border border-gray-300 rounded-md p-2" placeholder="Mínimo 6 caracteres">
            </div>

            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition duration-200">
                Crear Cuenta Admin
            </button>
        </form>

        <p class="mt-4 text-center text-sm">
            ¿Ya tienes una cuenta? <a href="login.html" class="text-green-600 hover:text-green-800 font-medium">Inicia Sesión aquí.</a>
        </p>
    </div>

    <script type="module">
        // --- 1. IMPORTACIONES ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- 2. CONFIGURACIÓN (Debe ser idéntica a tu index.html) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAWCPbrKbfVNieWdjIWOmsr27sqAWzEefk", 
            authDomain: "profutbolapp.firebaseapp.com",
            projectId: "profutbolapp",
            storageBucket: "profutbolapp.firebasestorage.app",
            messagingSenderId: "187277252854",
            appId: "1:187277252854:web:73d371c14b28f764de74d7"
        };
        
        // --- 3. CONSTANTES Y VARIABLES ---
        const USUARIOS_COLLECTION_PATH = 'usuarios'; 
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        // Conexión a la base de datos secundaria (base1reservas)
        const db = getFirestore(app, 'base1reservas'); 
        
        // Elementos del DOM
        const registroForm = document.getElementById('registroAdminForm');
        const adminEmailInput = document.getElementById('adminEmail');
        const adminNombreInput = document.getElementById('adminNombre');
        const adminApellidoInput = document.getElementById('adminApellido');
        const adminPasswordInput = document.getElementById('adminPassword');
        const messageBox = document.getElementById('message');

        // --- 4. FUNCIÓN AUXILIAR PARA MENSAJES ---
        function showMessage(text, isError) {
            messageBox.textContent = text;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            if (isError) {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                messageBox.classList.add('bg-green-100', 'text-green-700');
            }
        }

        // --- 5. LÓGICA DE REGISTRO ADMIN ---
        registroForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = adminEmailInput.value;
            const password = adminPasswordInput.value;
            const nombre = adminNombreInput.value;
            const apellido = adminApellidoInput.value;
            
            showMessage("Registrando...", false);

            try {
                // Paso 1: Crear el usuario en Firebase Authentication
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const uid = userCredential.user.uid;

                // Paso 2: Crear el documento en Firestore con el rol 'admin'
                const userData = {
                    email: email,
                    nombre: nombre,
                    apellido: apellido,
                    fecha_registro: serverTimestamp(),
                    // CRÍTICO: Asignar el rol de administrador para la seguridad en index.html
                    rol: 'usuario' 
                };

                const userRef = doc(db, USUARIOS_COLLECTION_PATH, uid);
                await setDoc(userRef, userData); 
                
                showMessage("¡Registro de administrador exitoso! Redirigiendo...", false);
                
                // Redirigir al panel de administración (index.html)
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);

            } catch (error) {
                console.error("Error al registrar administrador:", error);
                let errorMessage = "Error desconocido al registrar.";
                
                if (error.code === 'auth/weak-password') {
                    errorMessage = 'La contraseña debe tener al menos 6 caracteres.';
                } else if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'El correo electrónico ya está registrado.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'El formato del correo electrónico es inválido.';
                }
                
                showMessage(`Error al registrar: ${errorMessage}`, true);
            }
        });
    </script>
</body>
</html>